---
title: BIOS加电自检
date: 2017-04-21 16:28:16
tags: CSDN迁移
---
   网上有很多自检的资料，可是都不够全面，稍作整理如下：  


 6210 9845 4000 5103 480  


 一、首先了解几个概念

 1.BIOS寻址概念：  
以前寄存器是16位，寻址通过cs:ip方式，Bios地址为段地址左移4位 + 偏移地址。  
例如CS＝F000H，IP＝FFF0H，地址为F0000H + FFF0H = FFFF0H。  
那么，在386以前系统可寻址范围为1MB即 00000H~FFFFFH。  
  
2. 实模式下,1M范围内的地址是这样分配的：  
0x00000-0x9ffff 基本内存(程序可以使用的内存范围)  
0xa0000-0xb0000 EGA/VGA/XGA/XVGA图形视频缓冲区(64k)  
0xb0000-0xb8000 Mono text video buffer  
0xb8000-0xc0000 CGA/EGA+ chroma text video buffer  
0xc0000-0xFE000 cardbios & bios   
0xFE000-0xFFFFF bios boot block  
从0xa0000-0xFFFFF开始就不是基本内存了,虽然它们都是在内存里,但是它们被bios, EGA/VGA 等占用了。  
  
3. BIOS影子内存  
因为BIOS使用的ROM比我们使用的普通内存RAM要慢很多，所以人们就想出在启动后把BIOS的ROM里面的信息拷贝到我们插的内存条（RAM）里来，提高读取速度，而在RAM里的这些BIOS的信息就叫做BIOS影子内存。  
  
4. BDA(bios数据区)  
When the computer is powered-on, the BIOS Data Area is created by POST at memory location 0040:0000h (000400h) with a size of 256 bytes (0040:0000h-0040:00FFh). This area contains information about the system configuration.  
​  
地址 0040:0000  
其中 0040:0075 记录着硬盘个数；  
  
二、启动过程  
1. 加电  
当我们按下电源开关时，CPU 马上就从地址FFFF0H处开始执行指令，这个地址在系统BIOS的地址范围内，无论是Award BIOS还是AMI BIOS，放在这里的只是一条跳转指令，跳到系统BIOS中真正的启动代码处。  
  
关于入口地址的形成，有的文章上说是CS 0xFFFF和IP 0x0000的组成，有的文章上说是 CS 0xF000 和IP 0xFFF0的组合，我猜可能是不同硬件的初始化不同，只要最后形成的入口地址是 0xFFFF0就行了。  
  
2. 自检  
系统BIOS的启动代码首先要做的事情就是进行POST(Power On Self Test，加电自检)，POST的主要任务是检测系统中的一些关键设备是否存在和能否正常工作，如内存和显卡等。由于POST的检测过程在显示卡初始化之前，因此如果在POST自检的过程中发现了一些致命错误，如没有找到内存或者内存有问题时(POST过程只检查640K常规内存)，是无法在屏幕上显示出来的，这时系统PIOS可通过喇叭发声来报告错误情况，声音的长短和次数代表了错误的类型。在正常情况下，POST过程进行得非常快，我们几乎无法感觉到这个过程。  
  
3. 查找显示卡的BIOS  
存放显示卡BIOS的ROM芯片的起始地址通常在C0000H处，系统BIOS找到显卡BIOS之后调用它的初始化代码，由显卡BIOS来完成显示卡的初始化。大多数显示卡在这个过程通常会在屏幕上显示出一些显示卡的信息，如生产厂商、图形芯片类型、显存容量等内容，这就是我们开机看到的第一个画面，不过这个画面几乎是一闪而过的，也有的显卡BIOS使用了延时功能，以便用户可以看清显示的信息。接着系统BIOS会查找其它设备的BIOS程序，找到之后同样要调用这些BIOS内部的初始化代码来初始化这些设备。  
  
4. 显示BIOS自己的信息  
查找完所有其它设备的BIOS之后，系统BIOS将显示它自己的启动画面，其中包括有系统BIOS的类型、序列号和版本号等内容。同时屏幕底端左下角会出现主板信息代码，包含BIOS的日期、主板芯片组型号、主板的识别编码及厂商代码等。  
  
5. 检测CPU及内存条  
接着系统BIOS将检测CPU的类型和工作频率，并将检测结果显示在屏幕上，这就是我们开机看到的CPU类型和主频。接下来系统BIOS开始测试主机所有的内存容量，并同时在屏幕上显示内存测试的数值，就是大家所熟悉的屏幕上半部份那个飞速翻滚的内存计数器。这个过程我们可以在BIOS设置中选择耗时少的"快速检测"或者耗时多的"全面检测"方式。  
  
6. 检测标准硬件设备  
内存测试通过之后，系统BIOS将开始检测系统中安装的一些标准硬件设备，这些设备包括：硬盘、CD-ROM、软驱、串行接口和并行接口等连接的设备，另外绝大多数新版本的系统BIOS在这一过程中还要自动检测和设置内存的定时参数、硬盘参数和访问模式等。  
  
7. 检测即插即用设备  
标准设备检测完毕后，系统BIOS内部的支持即插即用的代码将开始检测和配置系统中安装的即插即用设备，每找到一个设备之后，系统BIOS都会在屏幕上显示出设备的名称和型号等信息，同时为该设备分配中断、DMA通道和I/O端口等资源。  
  
8. 标准设备检测完毕  
到这一步为止，所有硬件都已经检测配置完毕了，系统BIOS会重新清屏并在屏幕上方显示出一个系统配置列表，其中概略地 列出了系统中安装的各种标准硬件设备，以及它们使用的资源和一些相关工作参数。  
  
9. 更新ESCD  
系统BIOS将更新ESCD(Extended System Configuration Data，扩展系统配置数据)。ESCD是系统BIOS用来与操作系统交换硬件配置信息的数据，这些数据被存放在CMOS(一小块特殊的RAM，由主板上的电池来供电)之中。通常ESCD数据只在系统硬件配置发生改变后才会进行更新，所以不是每次启动机器时我们都能够看到"Update ESCD... Success"这样的信息，不过，某些主板的系统BIOS在保存ESCD数据时使用了与Windows 9x不相同的数据格式，于是Windows 9x在它自己的启动过程中会把ESCD数据转换成自己的格式，但在下一次启动机器时，即使硬件配置没有发生改变，系统BIOS又会把ESCD的数据格式改回来，如此循环，将会导致在每次启动机器时，系统BIOS都要更新一遍ESCD，这就是为什么有的计算 机在每次启动时都会显示"Update ESCD... Success"信息的原因。  
  
10. 启动系统  
ESCD数据更新完毕后，系统BIOS的启动代码将进行它的最后一项工作，即根据用户指定的启动顺序从软盘、硬盘或光驱启动。以从C盘启动为例，系统BIOS将读取并执行硬盘上的主引导记录，主引导记录接着从分区表中找到第一个活动分区，然后读取并执行这个活动分区的分区引导记录，而分区引导记录将负责读取并执行IO.SYS，这是DOS和Windows 9x最基本的系统文件。Windows 9x的IO.SYS首先要初始化一些重要的系统数据，然后就显示出我们熟悉的蓝天白云，在这幅画面之下，Windows将继续进行DOS部分和GUI(图形用户界面)部分的引导和初始化工作。如果系统这中安装有引导多种操件系统的工具软件，通常主引导记录将被替换成该软件的引导代码，这些代码将允许用户选择一种操作系统，然后读取并执行该操作系统的基本引导代码(DOS和Wind ows的基本引导代码就是分区引导记录)。  
  
  
 上面介绍的便是计算机在打开电源开关(或按Reset键)进行冷启动时所要完成的各种初始化工作，如果我们在DOS下按Ctrl +Alt+Del组合键(或从Windows中选择重新计算机)来进行热启动，那么POST过程将被跳过去，直接从第三步开始，另外第五步的检测CPU和内存测试也不会再进行。无论是冷启动还是热启动，系统BIOS都会重复上面的硬件检测和引导过程，正是这个不起眼的过程保证了我们可以正常的启动和使用计算机。   
 